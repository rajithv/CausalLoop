<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CausalLoop - Dynamic Causal Loop Diagramming Tool</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>CausalLoop</h1>
            <p>Dynamic Causal Loop Diagramming Tool</p>
        </header>

        <div class="main-content">
            <div class="control-panel">
                <div class="simulation-controls">
                    <h3>Simulation Controls</h3>
                    <div class="control-group">
                        <button id="start-simulation">Start Animation</button>
                        <button id="stop-simulation">Stop Animation</button>
                        <button id="reset-simulation">Reset Values</button>
                    </div>
                    <div class="control-group">
                        <label for="speed-slider">Animation Speed:</label>
                        <input type="range" id="speed-slider" min="100" max="2000" value="500">
                        <span id="speed-value">500ms</span>
                    </div>
                    <div class="control-group">
                        <label for="damping-slider">Damping Factor:</label>
                        <input type="range" id="damping-slider" min="0.1" max="1.0" step="0.1" value="0.9">
                        <span id="damping-value">0.9</span>
                    </div>
                </div>

                <div class="node-controls">
                    <h3>Node Controls</h3>
                    <div id="node-controls-container">
                        <!-- Node controls will be dynamically generated here -->
                    </div>
                </div>
            </div>

            <div class="visualization-panel">
                <div class="graph-controls">
                    <button id="zoom-in" class="zoom-btn" title="Zoom In">+</button>
                    <button id="zoom-out" class="zoom-btn" title="Zoom Out">−</button>
                    <button id="zoom-reset" class="zoom-btn" title="Reset Zoom">⌂</button>
                    <button id="fit-to-content" class="zoom-btn" title="Fit to Content">⊡</button>
                </div>
                <div class="graph-container" id="graph-container">
                    <svg id="causal-diagram" width="1200" height="800">
                        <g id="graph-content">
                            <!-- SVG elements will be dynamically created here -->
                        </g>
                    </svg>
                </div>
            </div>
        </div>

        <div class="graph-builder-section">
            <div class="graph-builder-header" id="graph-builder-toggle">
                <h3>
                    <span class="toggle-icon">▶</span>
                    Graph Builder
                </h3>
                <p class="builder-description">Define your causal loop graph structure and initial values</p>
            </div>
            
            <div class="graph-builder-content" id="graph-builder-content">
                <div class="graph-builder-scrollable">
                    <div class="builder-tabs">
                        <button class="tab-button active" data-tab="visual">Visual Builder</button>
                        <button class="tab-button" data-tab="text">Text Definition</button>
                    </div>

                    <div class="tab-content active" id="visual-builder">
                        <div class="builder-actions">
                            <button id="build-graph-visual" class="build-button">Build Graph from Visual</button>
                            <button id="clear-graph" class="action-button secondary">Clear All</button>
                        </div>

                        <div class="builder-section">
                            <h4>Nodes</h4>
                            <div class="node-management">
                                <div class="node-list" id="node-list">
                                    <!-- Node items will be added here -->
                                </div>
                                <button id="add-node-btn" class="action-button">+ Add Node</button>
                            </div>
                        </div>

                        <div class="builder-section">
                            <h4>Connections (Adjacency List)</h4>
                            <div class="connections-container">
                                <div class="connections-list" id="connections-list">
                                    <!-- Connection items will be added here -->
                                </div>
                                <button id="add-connection-btn" class="action-button secondary">+ Add Connection</button>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content" id="text-builder">
                        <div class="input-section">
                            <button id="build-graph">Build Graph from Text</button>
                            <div class="example-selector">
                                <label for="example-select">Load Example:</label>
                                <select id="example-select">
                                    <option value="">Select an example...</option>
                                    <option value="simple">Simple Loop</option>
                                    <option value="population">Population Growth</option>
                                    <option value="economic">Economic Feedback</option>
                                    <option value="climate">Climate Change</option>
                                    <option value="organization">Organizational Learning</option>
                                </select>
                            </div>
                            <textarea id="graph-input" placeholder="Enter your causal loop graph definition:
Example:
A -> B (0.8, +)
B -> C (0.6, -)
C -> A (0.5, +)
A -> D (0.3, +)

Node values (with optional perturbation amounts):
A: 50 (10)
B: 30 (5)
C: 40 (3)
D: 20 (7)"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="instructions-section">
            <div class="instructions-header" id="instructions-toggle">
                <h3>
                    <span class="toggle-icon">▶</span>
                    Instructions & Help
                </h3>
                <p class="instructions-description">Learn how to use CausalLoop and understand the features</p>
            </div>
            
            <div class="instructions-content" id="instructions-content">
                <div class="instructions">
                    <h4>Getting Started:</h4>
                    <ul>
                        <li><strong>Quick Start:</strong> Use the example selector in the Graph Builder to load a pre-defined causal loop diagram</li>
                        <li><strong>Visual Builder:</strong> Create nodes and connections using the visual interface</li>
                        <li><strong>Text Builder:</strong> Define your graph using simple text notation</li>
                    </ul>

                    <h4>Graph Definition Format:</h4>
                    <ul>
                        <li><strong>Connections:</strong> NodeA -> NodeB (multiplier, polarity)</li>
                        <li><strong>Multiplier:</strong> 0.1 to 1.0 (strength of influence)</li>
                        <li><strong>Polarity:</strong> + (positive) or - (negative)</li>
                        <li><strong>Node Values:</strong> NodeName: initial_value (perturbation_amount)</li>
                        <li><strong>Perturbation Amount:</strong> Optional, defaults to 5 if not specified</li>
                    </ul>

                    <h4>Example Definition:</h4>
                    <pre style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin: 10px 0;">Population -> Resources (0.8, -)
Resources -> QualityOfLife (0.6, +)
QualityOfLife -> Population (0.5, +)

Node values:
Population: 100 (15)
Resources: 80 (10)
QualityOfLife: 70 (8)</pre>

                    <h4>Simulation Features:</h4>
                    <ul>
                        <li><strong>Real-time Animation:</strong> Watch values propagate through the causal loop</li>
                        <li><strong>Speed Control:</strong> Adjust animation speed from 100ms to 2000ms</li>
                        <li><strong>Damping Factor:</strong> Control system stabilization (0.1 = fast, 1.0 = oscillates)</li>
                        <li><strong>Node Controls:</strong> Individual sliders for each node</li>
                        <li><strong>Reset Function:</strong> Return all nodes to initial values</li>
                    </ul>

                    <h4>Manual Perturbation:</h4>
                    <ul>
                        <li><strong>Green up arrow:</strong> Click to increase node value by its perturbation amount</li>
                        <li><strong>Red down arrow:</strong> Click to decrease node value by its perturbation amount</li>
                        <li><strong>Interactive Control:</strong> Arrows appear above and below each node</li>
                        <li><strong>Custom Amounts:</strong> Each node can have its own perturbation amount</li>
                        <li><strong>System Testing:</strong> Use these to manually disturb the system and observe effects</li>
                    </ul>

                    <h4>Visual Elements:</h4>
                    <ul>
                        <li><strong>Positive Connections:</strong> Blue arrows indicate positive relationships</li>
                        <li><strong>Negative Connections:</strong> Red arrows indicate negative relationships</li>
                        <li><strong>Connection Strength:</strong> Arrow thickness represents relationship strength</li>
                        <li><strong>Node Colors:</strong> Nodes change color based on current values</li>
                        <li><strong>Value Display:</strong> Current values shown on each node</li>
                    </ul>

                    <h4>Graph Controls:</h4>
                    <ul>
                        <li><strong>Zoom In/Out:</strong> Use + and - buttons to zoom</li>
                        <li><strong>Reset Zoom:</strong> Click house icon to reset view</li>
                        <li><strong>Fit to Content:</strong> Click square icon to fit all nodes</li>
                        <li><strong>Pan:</strong> Click and drag to move the view</li>
                    </ul>

                    <h4>Understanding Causal Loops:</h4>
                    <ul>
                        <li><strong>Reinforcing Loops:</strong> Create exponential growth or decline</li>
                        <li><strong>Balancing Loops:</strong> Create stabilizing behavior</li>
                        <li><strong>Leverage Points:</strong> Identify high-influence nodes</li>
                        <li><strong>Unintended Consequences:</strong> Observe cascade effects</li>
                    </ul>

                    <h4>Tips for Effective Use:</h4>
                    <ul>
                        <li><strong>Start Simple:</strong> Begin with 3-4 nodes and basic connections</li>
                        <li><strong>Test Perturbations:</strong> Use manual controls to test system response</li>
                        <li><strong>Observe Patterns:</strong> Look for oscillations or exponential growth</li>
                        <li><strong>Iterate Design:</strong> Refine by adjusting multipliers and connections</li>
                        <li><strong>Real-world Validation:</strong> Compare with actual observations</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script src="examples.js"></script>
    <script src="script.js"></script>
</body>
</html>
